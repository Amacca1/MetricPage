<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GitHub Claude Test Generator</title>
    <style>
        body { font-family: monospace; background: #23272e; color: #eee; }
        input, button, select, textarea { font-family: monospace; }
        .container { max-width: 900px; margin: 40px auto; background: #2c313a; padding: 24px; border-radius: 8px; }
        .section { margin-bottom: 2em; }
        textarea { width: 100%; min-height: 120px; background: #181a20; color: #eee; border: 1px solid #444; }
        pre { background: #181a20; color: #eee; padding: 12px; border-radius: 6px; }
    </style>
</head>
<body>
<div class="container">
    <h1>GitHub Claude Test Generator</h1>
    <div class="section">
        <label>GitHub Username: <input id="username" /></label>
        <button onclick="loadRepos()">List Repos</button>
        <select id="repoSelect" onchange="loadFiles()"></select>
        <select id="fileSelect" onchange="loadFileContent()"></select>
    </div>
    <div class="section">
        <h3>Python File Content</h3>
        <textarea id="fileContent" readonly></textarea>
        <button onclick="generateTests()">Generate Tests with Claude</button>
    </div>
    <div class="section">
        <h3>Generated Test Code</h3>
        <textarea id="testCode"></textarea>
        <button onclick="runTest()">Run Test in Sandbox</button>
    </div>
    <div class="section">
        <h3>Test Output</h3>
        <pre id="testOutput"></pre>
    </div>
</div>
<script>
async function loadRepos() {
    const username = document.getElementById('username').value;
    const res = await fetch(`/repos?username=${encodeURIComponent(username)}`);
    const data = await res.json();
    const repoSelect = document.getElementById('repoSelect');
    repoSelect.innerHTML = '';
    if (data.repos) {
        data.repos.forEach(repo => {
            const opt = document.createElement('option');
            opt.value = repo;
            opt.textContent = repo;
            repoSelect.appendChild(opt);
        });
        loadFiles();
    }
}
async function loadFiles() {
    const username = document.getElementById('username').value;
    const repo = document.getElementById('repoSelect').value;
    const res = await fetch(`/repo_files?username=${encodeURIComponent(username)}&repo=${encodeURIComponent(repo)}`);
    const data = await res.json();
    const fileSelect = document.getElementById('fileSelect');
    fileSelect.innerHTML = '';
    if (data.files) {
        data.files.forEach(file => {
            const opt = document.createElement('option');
            opt.value = file;
            opt.textContent = file;
            fileSelect.appendChild(opt);
        });
        loadFileContent();
    }
}
async function loadFileContent() {
    const username = document.getElementById('username').value;
    const repo = document.getElementById('repoSelect').value;
    const path = document.getElementById('fileSelect').value;
    const res = await fetch(`/file_content?username=${encodeURIComponent(username)}&repo=${encodeURIComponent(repo)}&path=${encodeURIComponent(path)}`);
    const data = await res.json();
    document.getElementById('fileContent').value = data.content || '';
    document.getElementById('testCode').value = '';
    document.getElementById('testOutput').textContent = '';
}
async function generateTests() {
    const code = document.getElementById('fileContent').value;
    if (!code) return;
    const res = await fetch('/generate_tests', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({code})
    });
    const data = await res.json();
    if (data.tests && data.tests.length > 0) {
        document.getElementById('testCode').value = data.tests.map(t => t.test_code).join('\n\n');
    } else {
        document.getElementById('testCode').value = data.error || 'No tests generated.';
    }
}
async function runTest() {
    const code = document.getElementById('fileContent').value;
    const test_code = document.getElementById('testCode').value;
    if (!code || !test_code) return;
    document.getElementById('testOutput').textContent = 'Running...';
    const res = await fetch('/run_test', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({code, test_code})
    });
    const data = await res.json();
    document.getElementById('testOutput').textContent = data.output || data.error || '';
}
</script>
</body>
</html>